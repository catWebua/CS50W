name: payment_dim_new

description: payment dim entity created from scratch

key_table: networx_src.networx_global.ng_payments

aliases: []

features:
- type: field
  name: ep_interaction_status_id
  data_type: string
  asset: networx_prod.core.enterprise_pro_status_log
  join_name: null
  time_field: null
  filters: []
  field: status
- type: field
  name: ep_interaction_status
  data_type: string
  asset: networx_prod.core.enterprise_pro_status_log
  join_name: null
  time_field: null
  filters: []
  field: status_name
- type: field
  name: charge_type
  data_type: string
  asset: bill
  join_name: null
  time_field: null
  filters: []
  field: charge_type
- type: field
  name: client_id
  data_type: string
  asset: bill
  join_name: null
  time_field: null
  filters: []
  field: client_id
- type: field
  name: sale_id
  data_type: string
  asset: bill
  join_name: null
  time_field: null
  filters: []
  field: sale_id
- type: formula
  data_type: string
  name: is_authorization_payment
  sql: iff(lower({charge_type}) = 'authorization', true, false )
  features:
  - feature: charge_type
    alias: null
- type: formula
  data_type: number
  name: payment_number_in_bill
  sql: ROW_NUMBER() over (PARTITION BY {bill_id}, IFF(LOWER({charge_type}) = 'authorization',
    TRUE, FALSE) ORDER BY {created_at} ASC )
  features:
  - feature: charge_type
    alias: null
  - feature: bill_id
    alias: null
  - feature: created_at
    alias: null

related_assets:
  networx_prod.core.enterprise_pro_status_log:
    relationship: one_to_one
    joins:
    - default: true
      type: sql
      sql: '{source}.{payment_method_client_id} = {destination}.{client_id} and {source}.{created_at}
        between {destination}.{started_at} and coalesce({destination}.{ended_at}, current_timestamp())'
  networx_src.networx_global.ng_payments:
    relationship: one_to_one
    joins:
    - default: true
      type: fields
      fields:
      - source: payment_id
        destination: payment_id
        operator: equal
